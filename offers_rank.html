<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offer Rank</title>
<link rel="stylesheet" href="style.css">
<script type="module" src="./config.js"></script>

<style>
.rank-row {
    display: flex;
    align-items: center;
    padding: 14px 16px;
    border-bottom: 1px solid #f0f0f0;
    gap: 14px;
}
.rank-row:last-child {
    border-bottom: none;
}
.rank-number {
    width: 28px;
    height: 28px;
    background: #000;
    color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: 700;
    flex-shrink: 0;
}
.rank-app-icon {
    width: 44px;
    height: 44px;
    border-radius: 10px;
    object-fit: cover;
    border: 1px solid #e0e0e0;
    flex-shrink: 0;
}
.rank-app-info {
    flex: 1;
    min-width: 0;
}
.rank-app-name {
    font-size: 15px;
    font-weight: 600;
    color: #000;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.rank-price {
    font-size: 13px;
    color: #666;
    margin-top: 2px;
}
.rank-list {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 14px;
    overflow: hidden;
}
.loader {
    display: none;
    width: 40px;
    height: 40px;
    border: 4px solid #e0e0e0;
    border-top-color: #000;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 40px auto;
}
@keyframes spin { 100% { transform: rotate(360deg); } }
.no-data {
    text-align: center;
    padding: 60px 20px;
    color: #999;
    font-size: 15px;
}
</style>

<div class="container">
    <div class="header">
        <button class="back-btn" onclick="location='offers_link.html'">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M15 18L9 12L15 6"/>
            </svg>
        </button>
        <span class="header-title">Offer Rank</span>
        <div style="width:40px;"></div>
    </div>

    <div class="content">
        <div id="loader" class="loader"></div>
        <div id="rankList" class="rank-list" style="display:none;"></div>
        <p id="noData" class="no-data" style="display:none;">No offers available</p>
    </div>
</div>

<script type="module">
import { db } from "./config.js"
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js"

const userID = localStorage.getItem("rony_local")
if (!userID) location = "login.html"

function el(id) { return document.getElementById(id) }

async function loadRank() {
    el("loader").style.display = "block"

    const appsSnap = await getDocs(collection(db, "apps"))
    const appsMap = {}
    appsSnap.forEach(d => { appsMap[d.id] = d.data() })

    const rankSnap = await getDocs(collection(db, "offer_rank"))
    const rankList = []
    rankSnap.forEach(d => {
        const x = d.data()
        if (x.disabled === true) return
        if (!x.hasOwnProperty("disabled")) return
        rankList.push({ id: d.id, ...x })
    })

    rankList.sort((a, b) => Number(a.rank) - Number(b.rank))

    el("loader").style.display = "none"

    if (rankList.length === 0) {
        el("noData").style.display = "block"
        return
    }

    const container = el("rankList")
    container.style.display = "block"

    rankList.forEach((item, idx) => {
        const app = appsMap[item.id] || {}
        const row = document.createElement("div")
        row.className = "rank-row"
        row.innerHTML = `
            <div class="rank-number">${idx + 1}</div>
            <img class="rank-app-icon" src="${app.image || ''}" alt="${app.title || ''}">
            <div class="rank-app-info">
                <div class="rank-app-name">${app.title || 'Unknown App'}</div>
                ${item.price ? `<div class="rank-price">â‚¹${item.price}</div>` : ''}
            </div>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 18l6-6-6-6"/>
            </svg>
        `
        container.appendChild(row)
    })
}

loadRank()
</script>
